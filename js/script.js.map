{"version":3,"sources":["script.js"],"names":["CPCustomize","fieldKey","tagsToRemove","blogDetails","event","formElements","srcElement","Object","values","signupEmail","forEach","formElement","name","value","dynamicField","querySelector","target","checked","style","display","bpMainContainer","document","signupForm","signupSubmit","extraTplNotices","privacyPolicy","nouveauRegisterWrapper","blogCheckbox","tagsToRemoveCompletely","slice","hiddenField","createElement","setAttribute","appendChild","addEventListener","onFormSubmit","bind","remove","nouveauFeedback","prepend","classList","contains","push","selector","extraSelector","querySelectorAll","length","indexOf","tag","getAttribute","toggleBlogForm","insertBefore","parentNode","add","marginTop","confirmationFeedback","removeAttribute","activationPage","activationForm","activatedFormLink","activationSubmit","elt","children","nodeType","registerPage","activatePage","customizeSignUp","customizeSignupConfirmation","customizeSignupActivation","settings","window","communauteProtegee","cpCustomize","readyState","start"],"mappings":"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","file":"script.js","sourceRoot":"../src/js","sourcesContent":["/**\n * DOM customizations.\n */\nclass CPCustomize {\n\tconstructor( { fieldKey } ) {\n\t\tthis.fieldKey = fieldKey;\n\t\tthis.tagsToRemove = [\n\t\t\t'.field-visibility-settings-notoggle',\n\t\t\t'.field-visibility-settings-toggle',\n\t\t\t'.field-visibility-settings'\n\t\t];\n\t\tthis.blogDetails = null;\n\t}\n\n\tonFormSubmit( event ) {\n\t\tconst formElements = event.srcElement ? Object.values( event.srcElement ) : [];\n\t\tlet signupEmail = '';\n\n\t\tformElements.forEach( ( formElement ) => {\n\t\t\tif ( 'signup_email' === formElement.name || 'privacy_policy_email' === formElement.name ) {\n\t\t\t\tsignupEmail = formElement.value;\n\t\t\t}\n\n\t\t\tif ( this.fieldKey === formElement.name ) {\n\t\t\t\tconst dynamicField = event.srcElement.querySelector( '[name=\"' + formElement.name + '\"]' );\n\n\t\t\t\tif ( null !== dynamicField ) {\n\t\t\t\t\tdynamicField.value = signupEmail;\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\ttoggleBlogForm( event ) {\n\t\tif ( true === event.target.checked ) {\n\t\t\tthis.blogDetails.style.display = 'block';\n\t\t} else {\n\t\t\tthis.blogDetails.style.display = 'none';\n\t\t}\n\t}\n\n\tcustomizeSignUp() {\n\t\tconst bpMainContainer = document.querySelector( '#buddypress' );\n\t\tconst signupForm = document.querySelector( 'form[name=\"signup_form\"]' );\n\t\tconst signupSubmit = null !== signupForm ? signupForm.querySelector( '[name=\"signup_submit\"]' ) : null;\n\t\tconst extraTplNotices = null !== signupForm ? signupForm.querySelector( '#template-notices' ) : null;\n\t\tconst privacyPolicy = null !== signupForm ? signupForm.querySelector( '.privacy-policy-accept' ) : null;\n\t\tconst nouveauRegisterWrapper = document.querySelector( '#register-page form[name=\"signup_form\"] .layout-wrap' );\n\t\tconst blogDetails = document.querySelector( '#blog-details' );\n\t\tconst blogCheckbox = document.querySelector( '[name=\"signup_with_blog\"]' );\n\t\tconst tagsToRemoveCompletely = this.tagsToRemove.slice( 0, 3 );\n\n\t\t// Customize Form.\n\t\tif ( null !== signupForm ) {\n\t\t\tconst hiddenField = document.createElement( 'input' );\n\n\t\t\t// Adds a dynamic field to check the user is a human.\n\t\t\thiddenField.setAttribute( 'type', 'hidden' );\n\t\t\thiddenField.setAttribute( 'name', this.fieldKey )\n\t\t\tsignupForm.appendChild( hiddenField );\n\n\t\t\t// Listens to form submit.\n\t\t\tsignupForm.addEventListener( 'submit', this.onFormSubmit.bind( this ) );\n\n\t\t\t// Removes Legacy Template Pack extra notices container.\n\t\t\tif ( null !== extraTplNotices ) {\n\t\t\t\textraTplNotices.remove();\n\t\t\t}\n\n\t\t\t// Moves Nouveau Template Pack Feedback selector into the Form.\n\t\t\tif ( null !== nouveauRegisterWrapper ) {\n\t\t\t\tconst nouveauFeedback = document.querySelector( '#register-page aside.bp-feedback' );\n\n\t\t\t\tif ( null !== nouveauFeedback ) {\n\t\t\t\t\tnouveauRegisterWrapper.prepend( nouveauFeedback );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Adds extra inputs and labels of the Legacy template pack to the tags to remove.\n\t\t\tif ( bpMainContainer && ! bpMainContainer.classList.contains( 'buddypress-wrap' ) ) {\n\t\t\t\tthis.tagsToRemove.push( '#signup_password',\t'#pass-strength-result', 'label[for=\"signup_password_confirm\"]', '#signup_password_confirm' );\n\t\t\t}\n\n\t\t\t// Removes not needed tags.\n\t\t\tthis.tagsToRemove.forEach( ( selector ) => {\n\t\t\t\tconst extraSelector = signupForm.querySelectorAll( selector );\n\n\t\t\t\tif ( extraSelector.length ) {\n\n\t\t\t\t\tif ( -1 === tagsToRemoveCompletely.indexOf( selector ) ) {\n\t\t\t\t\t\textraSelector[0].remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\textraSelector.forEach( ( tag ) => {\n\t\t\t\t\t\t\ttag.remove();\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tif ( null !== blogDetails && null !== blogCheckbox ) {\n\t\t\t\tthis.blogDetails = blogDetails;\n\n\t\t\t\tif ( ! blogCheckbox.getAttribute( 'checked' ) ) {\n\t\t\t\t\tthis.blogDetails.style.display = 'none';\n\t\t\t\t}\n\n\t\t\t\tblogCheckbox.addEventListener( 'click', this.toggleBlogForm.bind( this ) );\n\t\t\t}\n\n\t\t\t// Makes sure the Submit button style is consistent with the login form.\n\t\t\tif ( null !== privacyPolicy ) {\n\t\t\t\tsignupForm.insertBefore( privacyPolicy, signupSubmit.parentNode );\n\t\t\t\tprivacyPolicy.classList.add( 'register-section' );\n\t\t\t\tprivacyPolicy.style.marginTop = '1.5em';\n\t\t\t}\n\n\t\t\t// Makes sure the Submit button style is consistent with the login form.\n\t\t\tif ( null !== signupSubmit ) {\n\t\t\t\tsignupSubmit.setAttribute( 'id', 'wp-submit' );\n\t\t\t\tsignupSubmit.classList.add( 'button', 'button-primary', 'button-large' );\n\t\t\t}\n\t\t}\n\t}\n\n\tcustomizeSignupConfirmation() {\n\t\tconst confirmationFeedback = document.querySelector( 'aside.bp-feedback' );\n\t\tconst nouveauRegisterWrapper = document.querySelector( '#register-page form[name=\"signup_form\"] .layout-wrap' );\n\t\tconst extraTplNotices = document.querySelectorAll( 'form[name=\"signup_form\"] #template-notices' );\n\n\t\tif ( null !== confirmationFeedback && null !== nouveauRegisterWrapper ) {\n\t\t\tnouveauRegisterWrapper.prepend( confirmationFeedback );\n\t\t}\n\n\t\tif ( null !== extraTplNotices && 2 === extraTplNotices.length ) {\n\t\t\textraTplNotices[0].remove();\n\t\t\textraTplNotices[1].removeAttribute( 'id' );\n\t\t\textraTplNotices[1].removeAttribute( 'role' );\n\t\t\textraTplNotices[1].removeAttribute( 'aria-atomic' );\n\t\t\textraTplNotices[1].classList.add( 'register-section' );\n\t\t}\n\t}\n\n\tcustomizeSignupActivation() {\n\t\tconst activationPage = document.querySelector( '#activate-page' );\n\t\tconst nouveauFeedback = document.querySelector( 'aside.bp-feedback' );\n\t\tconst activationForm = document.querySelector( '#activation-form' );\n\t\tconst activatedFormLink = document.querySelector( 'body.bp-nouveau .activation-result.successful a' );\n\t\tconst activationSubmit = null !== activationForm ? activationForm.querySelector( '#activate [name=\"submit\"]' ) : null;\n\n\t\tif ( null !== activationSubmit ) {\n\t\t\tactivationSubmit.classList.add( 'button', 'button-primary', 'button-large' );\n\t\t}\n\n\t\tif ( null !== activatedFormLink ) {\n\t\t\tactivatedFormLink.classList.add( 'button', 'button-primary', 'button-large' );\n\t\t}\n\n\t\tif ( null !== activationPage && null !== activationForm ) {\n\t\t\tfor ( const elt in activationPage.children ) {\n\t\t\t\tif ( 1 === activationPage.children[ elt ].nodeType && 'activation-form' !== activationPage.children[ elt ].getAttribute( 'id' ) && 'template-notices' !== activationPage.children[ elt ].getAttribute( 'id' ) && activationPage.children[ elt ] !== nouveauFeedback ) {\n\t\t\t\t\tactivationForm.prepend( activationPage.children[ elt ] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstart() {\n\t\tconst registerPage = document.querySelector( '#register' );\n\t\tconst activatePage = document.querySelector( '#activate-page' );\n\n\t\tif ( this.fieldKey ) {\n\t\t\tthis.customizeSignUp();\n\t\t} else if ( null !== registerPage && registerPage.classList.contains( 'completed-confirmation' ) ) {\n\t\t\tthis.customizeSignupConfirmation();\n\t\t} else if ( null !== activatePage ) {\n\t\t\tthis.customizeSignupActivation();\n\t\t}\n\t}\n}\n\nconst settings = window.communauteProtegee && window.communauteProtegee.settings ? communauteProtegee.settings : {};\nconst cpCustomize = new CPCustomize( settings );\n\nif ( 'loading' === document.readyState ) {\n\tdocument.addEventListener( 'DOMContentLoaded', cpCustomize.start() );\n} else {\n\tcpCustomize.start();\n}\n"]}